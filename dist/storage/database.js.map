{"version":3,"sources":["../../src/storage/database.js"],"names":["debug","Database","memoryDB","Sequelize","persistedDB","Video","define","title","STRING","Peer","id","type","primaryKey","Log","createdAt","DATE","defaultValue","NOW","message","sync","force","close"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AACA,IAAMA,QAAQ,qBAAM,OAAN,CAAd;;IAEMC,Q;AACF,wBAAc;AAAA;;AACV,aAAKC,QAAL,GAAgB,IAAIC,mBAAJ,CAAc,iBAAd,EAAiC;AAC7C;AAD6C,SAAjC,CAAhB;AAGA,aAAKC,WAAL,GAAmB,IAAnB;AACA;AACA,aAAKC,KAAL,GAAa,KAAKH,QAAL,CAAcI,MAAd,CAAqB,OAArB,EAA8B;AACvCC,mBAAOC;AADgC,SAA9B,CAAb;AAGA,aAAKC,IAAL,GAAY,KAAKP,QAAL,CAAcI,MAAd,CAAqB,MAArB,EAA6B;AACrCI,gBAAI;AACAC,sBAAMH,iBADN;AAEAI,4BAAY;AAFZ;AADiC,SAA7B,CAAZ;AAMA,aAAKC,GAAL,GAAW,KAAKX,QAAL,CAAcI,MAAd,CAAqB,KAArB,EAA4B;AACnCQ,uBAAW,EAAEH,MAAMI,eAAR,EAAcC,cAAcC,cAA5B,EADwB;AAEnCC,qBAASV;AAF0B,SAA5B,CAAX;AAIH;;;;+BACM;AACH,mBAAO,KAAKN,QAAL,CAAciB,IAAd,CAAmB,EAACC,OAAO,IAAR,EAAnB,CAAP,CADG,CACuC;AAC7C;;;gCACO;AACJ,mBAAO,KAAKlB,QAAL,CAAcmB,KAAd,EAAP;AACH;;;;;;kBAGUpB,Q","file":"database.js","sourcesContent":["import sqlite3 from \"sqlite3\";\nimport Sequelize, { STRING, DATE, NOW } from \"sequelize\";\nimport assert from \"assert\";\nimport Debug from 'debug';\nconst debug = Debug('ao:db');\n\nclass Database {\n    constructor() {\n        this.memoryDB = new Sequelize('sqlite::memory:', {\n            // logging: false\n        })\n        this.persistedDB = null\n        // Model definitions\n        this.Video = this.memoryDB.define('video', {\n            title: STRING\n        })\n        this.Peer = this.memoryDB.define('peer', {\n            id: {\n                type: STRING,\n                primaryKey: true,\n            }\n        })\n        this.Log = this.memoryDB.define('log', {\n            createdAt: { type: DATE, defaultValue: NOW },\n            message: STRING\n        })\n    }\n    init() {\n        return this.memoryDB.sync({force: true})  // syncs all models (create tables)\n    }\n    close() {\n        return this.memoryDB.close()\n    }\n}\n\nexport default Database;"]}